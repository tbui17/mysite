/*! For license information please see history.js.LICENSE.txt */
!function(){var t={33042:function(t,e,n){var r;!function(){"use strict";var i=function t(e){var n,r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),i={use_static:!1};function s(t){var e=Object.getPrototypeOf(t);return e?Object.create(e):{}}function o(t,e,n){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:n})}function a(t,e){o(t,e,(function(){throw new h("The "+e+" method cannot be invoked on an Immutable data structure.")}))}"object"!=typeof(n=e)||Array.isArray(n)||null===n||void 0!==e.use_static&&(i.use_static=Boolean(e.use_static));var u="__immutable_invariants_hold";function c(t){return"object"!=typeof t||(null===t||Boolean(Object.getOwnPropertyDescriptor(t,u)))}function l(t,e){return t===e||t!=t&&e!=e}function p(t){return!(null===t||"object"!=typeof t||Array.isArray(t)||t instanceof Date)}var d=["setPrototypeOf"],y=d.concat(["push","pop","sort","splice","shift","unshift","reverse"]),f=["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]),m=d.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);function h(t){this.name="MyError",this.message=t,this.stack=(new Error).stack}function v(t,e){for(var n in o(t,u,!0),e)e.hasOwnProperty(n)&&a(t,e[n]);return Object.freeze(t),t}function g(t,e){var n=t[e];o(t,e,(function(){return G(n.apply(t,arguments))}))}function S(t,e,n){var r=n&&n.deep;if(t in this&&(r&&this[t]!==e&&p(e)&&p(this[t])&&(e=G.merge(this[t],e,{deep:!0,mode:"replace"})),l(this[t],e)))return this;var i=O.call(this);return i[t]=G(e),E(i)}h.prototype=new Error,h.prototype.constructor=Error;var I=G([]);function b(t,e,n){var r=t[0];if(1===t.length)return S.call(this,r,e,n);var i,s=t.slice(1),o=this[r];if("object"==typeof o&&null!==o)i=G.setIn(o,s,e);else{var a=s[0];i=""!==a&&isFinite(a)?b.call(I,s,e):C.call(U,s,e)}if(r in this&&o===i)return this;var u=O.call(this);return u[r]=i,E(u)}function E(t){for(var e in f){if(f.hasOwnProperty(e))g(t,f[e])}i.use_static||(o(t,"flatMap",A),o(t,"asObject",w),o(t,"asMutable",O),o(t,"set",S),o(t,"setIn",b),o(t,"update",H),o(t,"updateIn",z),o(t,"getIn",F));for(var n=0,r=t.length;n<r;n++)t[n]=G(t[n]);return v(t,y)}function T(){return new Date(this.getTime())}function A(t){if(0===arguments.length)return this;var e,n=[],r=this.length;for(e=0;e<r;e++){var i=t(this[e],e,this);Array.isArray(i)?n.push.apply(n,i):n.push(i)}return E(n)}function _(t){if(void 0===t&&0===arguments.length)return this;if("function"!=typeof t){var e=Array.isArray(t)?t.slice():Array.prototype.slice.call(arguments);e.forEach((function(t,e,n){"number"==typeof t&&(n[e]=t.toString())})),t=function(t,n){return-1!==e.indexOf(n)}}var n=s(this);for(var r in this)this.hasOwnProperty(r)&&!1===t(this[r],r)&&(n[r]=this[r]);return $(n)}function O(t){var e,n,r=[];if(t&&t.deep)for(e=0,n=this.length;e<n;e++)r.push(P(this[e]));else for(e=0,n=this.length;e<n;e++)r.push(this[e]);return r}function w(t){"function"!=typeof t&&(t=function(t){return t});var e,n={},r=this.length;for(e=0;e<r;e++){var i=t(this[e],e,this),s=i[0],o=i[1];n[s]=o}return $(n)}function P(t){return!t||"object"!=typeof t||!Object.getOwnPropertyDescriptor(t,u)||t instanceof Date?t:G.asMutable(t,{deep:!0})}function D(t,e){for(var n in t)Object.getOwnPropertyDescriptor(t,n)&&(e[n]=t[n]);return e}function M(t,e){if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(t));var n,r,i=Array.isArray(t),o=e&&e.deep,a=e&&e.mode||"merge",u=e&&e.merger;function c(t,r,i){var a,c=G(r[i]),d=u&&u(t[i],c,e),y=t[i];void 0===n&&void 0===d&&t.hasOwnProperty(i)&&l(c,y)||(l(y,a=void 0!==d?d:o&&p(y)&&p(c)?G.merge(y,c,e):c)&&t.hasOwnProperty(i)||(void 0===n&&(n=D(t,s(t))),n[i]=a))}function d(t,e){for(var r in t)e.hasOwnProperty(r)||(void 0===n&&(n=D(t,s(t))),delete n[r])}if(i)for(var y=0,f=t.length;y<f;y++){var m=t[y];for(r in m)m.hasOwnProperty(r)&&c(void 0!==n?n:this,m,r)}else{for(r in t)Object.getOwnPropertyDescriptor(t,r)&&c(this,t,r);"replace"===a&&d(this,t)}return void 0===n?this:$(n)}function R(t,e){var n=e&&e.deep;if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(t));return G.merge(this,t,{deep:n,mode:"replace"})}var j,N,L,U=G({});function C(t,e,n){if(!Array.isArray(t)||0===t.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var r=t[0];if(1===t.length)return k.call(this,r,e,n);var i,o=t.slice(1),a=this[r];if(i=this.hasOwnProperty(r)&&"object"==typeof a&&null!==a?G.setIn(a,o,e):C.call(U,o,e),this.hasOwnProperty(r)&&a===i)return this;var u=D(this,s(this));return u[r]=i,$(u)}function k(t,e,n){var r=n&&n.deep;if(this.hasOwnProperty(t)&&(r&&this[t]!==e&&p(e)&&p(this[t])&&(e=G.merge(this[t],e,{deep:!0,mode:"replace"})),l(this[t],e)))return this;var i=D(this,s(this));return i[t]=G(e),$(i)}function H(t,e){var n=Array.prototype.slice.call(arguments,2),r=this[t];return G.set(this,t,e.apply(r,[r].concat(n)))}function x(t,e){for(var n=0,r=e.length;null!=t&&n<r;n++)t=t[e[n]];return n&&n==r?t:void 0}function z(t,e){var n=Array.prototype.slice.call(arguments,2),r=x(this,t);return G.setIn(this,t,e.apply(r,[r].concat(n)))}function F(t,e){var n=x(this,t);return void 0===n?e:n}function Y(t){var e,n=s(this);if(t&&t.deep)for(e in this)this.hasOwnProperty(e)&&(n[e]=P(this[e]));else for(e in this)this.hasOwnProperty(e)&&(n[e]=this[e]);return n}function B(){return{}}function $(t){return i.use_static||(o(t,"merge",M),o(t,"replace",R),o(t,"without",_),o(t,"asMutable",Y),o(t,"set",k),o(t,"setIn",C),o(t,"update",H),o(t,"updateIn",z),o(t,"getIn",F)),v(t,d)}function G(t,e,n){if(c(t)||function(t){return"object"==typeof t&&null!==t&&(60103===t.$$typeof||t.$$typeof===r)}(t)||function(t){return"undefined"!=typeof File&&t instanceof File}(t)||function(t){return"undefined"!=typeof Blob&&t instanceof Blob}(t)||function(t){return t instanceof Error}(t))return t;if(function(t){return"object"==typeof t&&"function"==typeof t.then}(t))return t.then(G);if(Array.isArray(t))return E(t.slice());if(t instanceof Date)return s=new Date(t.getTime()),i.use_static||o(s,"asMutable",T),v(s,m);var s,a=e&&e.prototype,u=(a&&a!==Object.prototype?function(){return Object.create(a)}:B)();if(null==n&&(n=64),n<=0)throw new h("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");for(var l in n-=1,t)Object.getOwnPropertyDescriptor(t,l)&&(u[l]=G(t[l],void 0,n));return $(u)}function W(t){return function(){var e=[].slice.call(arguments),n=e.shift();return t.apply(n,e)}}function J(t,e){return function(){var n=[].slice.call(arguments),r=n.shift();return Array.isArray(r)?e.apply(r,n):t.apply(r,n)}}return G.from=G,G.isImmutable=c,G.ImmutableError=h,G.merge=W(M),G.replace=W(R),G.without=W(_),G.asMutable=(j=Y,N=O,L=T,function(){var t=[].slice.call(arguments),e=t.shift();return Array.isArray(e)?N.apply(e,t):e instanceof Date?L.apply(e,t):j.apply(e,t)}),G.set=J(k,S),G.setIn=J(C,b),G.update=W(H),G.updateIn=W(z),G.getIn=W(F),G.flatMap=W(A),G.asObject=W(w),i.use_static||(G.static=t({use_static:!0})),Object.freeze(G),G}();void 0===(r=function(){return i}.call(e,n,e,t))||(t.exports=r)}()},93967:function(t,e){var n;!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var t="",e=0;e<arguments.length;e++){var n=arguments[e];n&&(t=o(t,s(n)))}return t}function s(t){if("string"==typeof t||"number"==typeof t)return t;if("object"!=typeof t)return"";if(Array.isArray(t))return i.apply(null,t);if(t.toString!==Object.prototype.toString&&!t.toString.toString().includes("[native code]"))return t.toString();var e="";for(var n in t)r.call(t,n)&&t[n]&&(e=o(e,n));return e}function o(t,e){return e?t?t+" "+e:t+e:t}t.exports?(i.default=i,t.exports=i):void 0===(n=function(){return i}.apply(e,[]))||(t.exports=n)}()}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};!function(){"use strict";n.r(r),n.d(r,{DebugUserActivity:function(){return a},HistoryModal:function(){return b},HistoryModalContainer:function(){return T},add:function(){return R},addActionItem:function(){return j},addLayoutItem:function(){return N},addPresetSessionItem:function(){return L},allState:function(){return K},disableHistoryTracking:function(){return U},enableHistoryTracking:function(){return C},endPresetSession:function(){return k},getActionItems:function(){return V},getCurrentLayoutIndex:function(){return st},getLastUserActivity:function(){return ot},getLayoutItems:function(){return at},getRecentSubHistory:function(){return ct},getSavedState:function(){return lt},getSubHistory:function(){return ut},getUserActivityStatus:function(){return pt},hasPresetSessionRedo:function(){return dt},hasPresetSessionUndo:function(){return yt},hasRedo:function(){return ft},hasUndo:function(){return mt},historyModalDefinition:function(){return A},isHistoryTrackingEnabled:function(){return ht},isPresetSessionActive:function(){return vt},jumpToLayoutItem:function(){return H},presetSessionRedo:function(){return x},presetSessionUndo:function(){return z},redo:function(){return F},registerHistoryModal:function(){return _},registerHistoryStore:function(){return Ot},resetState:function(){return Y},setLastEditedLayoutState:function(){return B},setSavedState:function(){return $},setUserActivityStatus:function(){return G},startPresetSession:function(){return W},undo:function(){return J}});var t={};n.r(t),n.d(t,{add:function(){return R},addActionItem:function(){return j},addLayoutItem:function(){return N},addPresetSessionItem:function(){return L},disableHistoryTracking:function(){return U},enableHistoryTracking:function(){return C},endPresetSession:function(){return k},jumpToLayoutItem:function(){return H},presetSessionRedo:function(){return x},presetSessionUndo:function(){return z},redo:function(){return F},resetState:function(){return Y},setLastEditedLayoutState:function(){return B},setSavedState:function(){return $},setUserActivityStatus:function(){return G},startPresetSession:function(){return W},undo:function(){return J}});var e={};n.r(e),n.d(e,{allState:function(){return K},getActionItems:function(){return V},getCurrentLayoutIndex:function(){return st},getLastUserActivity:function(){return ot},getLayoutItems:function(){return at},getRecentSubHistory:function(){return ct},getSavedState:function(){return lt},getSubHistory:function(){return ut},getUserActivityStatus:function(){return pt},hasPresetSessionRedo:function(){return dt},hasPresetSessionUndo:function(){return yt},hasRedo:function(){return ft},hasUndo:function(){return mt},isHistoryTrackingEnabled:function(){return ht},isPresetSessionActive:function(){return vt}});var i=window.vendor.React,s=n.n(i),o=window.divi.data;const a=()=>{const{status:t,last:e}=(0,o.useSelect)((t=>({status:t("divi/history").getUserActivityStatus(),last:t("divi/history").getLastUserActivity()}))),n=new Date(e.timestamp).toLocaleString();return s().createElement("div",{className:"et-vb-user-activity-debug",style:{width:300,padding:20,backgroundColor:"idle"===t?"green":"maroon",position:"fixed",bottom:20,left:20,fontSize:12,lineHeight:"1em",color:"#FFFFFF",zIndex:1e4}},s().createElement("p",null,"Status:",t),s().createElement("p",null,"Last Timestamp:",e.timestamp),s().createElement("p",null,"Last Human Time:",n),s().createElement("p",null,"Last Edited Store:",e.storeName),s().createElement("p",null,"Last Action Type:",e.actionType))};var u=window.lodash,c=window.vendor.wp.i18n,l=window.divi.errorBoundary,p=window.divi.modal,d=n(93967),y=n.n(d),f=window.divi.iconLibrary,m=window.divi.window;const h=({humanTime:t,id:e,label:n,onClick:r,selected:o=!1,timestamp:a})=>{const u=(0,i.useRef)(null);return(0,i.useEffect)((()=>{o&&u?.current?.scrollIntoView()}),[o]),s().createElement("button",{className:y()({"et-vb-history-modal-history-item":!0,"et-vb-history-modal-history-item--selected":o}),"data-item-id":e,onClick:m.handleOnClickFallback,ref:u,type:"button",onMouseDown:()=>{r(e)}},o?s().createElement("span",{className:"et-vb-history-modal-history-item-status"},s().createElement(f.IconSvg,{name:"divi/check",size:11,color:"#FFFFFF"})):null,s().createElement("span",{className:"et-vb-history-modal-history-item-label"},n),s().createElement("span",{className:"et-vb-history-modal-history-item-timestamp","data-timestamp":a},t))},v=({currentLayoutIndex:t,jumpToLayoutItem:e,layoutItems:n})=>{const r=r=>{e(r===t?{layoutIndex:n?.length-1}:{layoutIndex:r})};return s().createElement("div",{className:"et-vb-history-modal-history-item-wrapper"},n.map(((e,n)=>s().createElement(h,{key:`history-item-${e.timestamp}`,humanTime:e.humanTime,id:n,label:e?.label??`${e.type} ${e.moduleName}`,onClick:r,selected:n===t,timestamp:e.timestamp}))))},g=()=>{const{jumpToLayoutItem:t}=(0,o.useDispatch)("divi/history"),{currentLayoutIndex:e,layoutItems:n}=(0,o.useSelect)((t=>({currentLayoutIndex:t("divi/history").getCurrentLayoutIndex(),layoutItems:t("divi/history").getLayoutItems()})));return s().createElement(v,{currentLayoutIndex:e,jumpToLayoutItem:t,layoutItems:n})},S="divi/history",I=(0,c.__)("History","et_builder"),b=({tab:t})=>s().createElement(l.ErrorBoundary,{key:"et-vb-divi-modals--history",componentName:"et-vb-divi-modals--history"},s().createElement(p.WrapperContainer,{modalName:S,modalActiveTab:t||"history",draggable:!0,expandable:!0,snappable:!0,resizable:!0,multiPanels:!0},s().createElement(p.Header,{name:(0,c.__)("History","et_builder"),onContextMenu:u.noop}),s().createElement(p.BodyPanelWrapperContainer,null,s().createElement(p.PanelContainer,{id:"history",label:(0,c.__)("Actions","et_builder")},s().createElement(g,null)))));var E=window.divi.keyboardShortcuts;const T=t=>{(0,i.useEffect)((()=>((0,E.registerShortcut)({name:"closeHistoryModal",label:(0,c.__)("Close History Modal","et_builder"),keys:["Escape"],category:"modal",action:()=>{(0,o.dispatch)("divi/modal-library").close({name:S})}}),()=>{(0,E.unregisterShortcut)("closeHistoryModal")})),[]);const e={tab:t?.tab};return(0,i.createElement)(b,{...t,...e})},A={component:T,name:S,label:I,snappable:!0,type:"multiInstanceModal",autoCloseOnClickOutside:!0},_=()=>{(0,o.dispatch)("divi/modal-library").addModal(A)};var O=n(33042),w=n.n(O),P=window.divi.middleware,D=window.divi.pageSettings,M=window.divi.serializedPost;const R=(t,e,n,r)=>({type:"ADD",category:t,actionType:e,trigger:n,payload:r}),j=t=>({type:"ADD_ACTION_ITEM",params:t}),N=t=>({type:"ADD_LAYOUT_ITEM",params:t}),L=t=>({type:"ADD_PRESET_SESSION_ITEM",params:t}),U=()=>({type:"DISABLE_HISTORY_TRACKING"}),C=()=>({type:"ENABLE_HISTORY_TRACKING"}),k=()=>({type:"END_PRESET_SESSION"}),H=t=>({type:"JUMP_TO_LAYOUT_ITEM",params:t}),x=()=>({type:"PRESET_SESSION_REDO"}),z=()=>({type:"PRESET_SESSION_UNDO"}),F=()=>({type:"REDO"}),Y=()=>({type:"RESET_STATE"}),B=t=>({type:"SET_LAST_EDITED_LAYOUT_STATE",params:t}),$=t=>({type:"SET_SAVED_STATE",params:t}),G=t=>({type:"SET_USER_ACTIVITY_STATUS",params:t}),W=()=>({type:"START_PRESET_SESSION"}),J=()=>({type:"UNDO"}),K=t=>t,V=(t,e)=>t.getIn(["actions",e.storeName,"items"]);function q(t,e="expected a function, instead received "+typeof t){if("function"!=typeof t)throw new TypeError(e)}var Q=t=>Array.isArray(t)?t:[t];function X(t){const e=Array.isArray(t[0])?t[0]:t;return function(t,e="expected all items to be functions, instead received the following types: "){if(!t.every((t=>"function"==typeof t))){const n=t.map((t=>"function"==typeof t?`function ${t.name||"unnamed"}()`:typeof t)).join(", ");throw new TypeError(`${e}[${n}]`)}}(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function Z(t,e){const n=[],{length:r}=t;for(let i=0;i<r;i++)n.push(t[i].apply(null,e));return n}Symbol(),Object.getPrototypeOf({});var tt="undefined"!=typeof WeakRef?WeakRef:class{constructor(t){this.value=t}deref(){return this.value}};function et(t,e={}){let n={s:0,v:void 0,o:null,p:null};const{resultEqualityCheck:r}=e;let i,s=0;function o(){let e=n;const{length:o}=arguments;for(let t=0,n=o;t<n;t++){const n=arguments[t];if("function"==typeof n||"object"==typeof n&&null!==n){let t=e.o;null===t&&(e.o=t=new WeakMap);const r=t.get(n);void 0===r?(e={s:0,v:void 0,o:null,p:null},t.set(n,e)):e=r}else{let t=e.p;null===t&&(e.p=t=new Map);const r=t.get(n);void 0===r?(e={s:0,v:void 0,o:null,p:null},t.set(n,e)):e=r}}const a=e;let u;if(1===e.s?u=e.v:(u=t.apply(null,arguments),s++),a.s=1,r){const t=i?.deref?.()??i;null!=t&&r(t,u)&&(u=t,0!==s&&s--);i="object"==typeof u&&null!==u||"function"==typeof u?new tt(u):u}return a.v=u,u}return o.clearCache=()=>{n={s:0,v:void 0,o:null,p:null},o.resetResultsCount()},o.resultsCount=()=>s,o.resetResultsCount=()=>{s=0},o}function nt(t,...e){const n="function"==typeof t?{memoize:t,memoizeOptions:e}:t,r=(...t)=>{let e,r=0,i=0,s={},o=t.pop();"object"==typeof o&&(s=o,o=t.pop()),q(o,`createSelector expects an output function after the inputs, but received: [${typeof o}]`);const a={...n,...s},{memoize:u,memoizeOptions:c=[],argsMemoize:l=et,argsMemoizeOptions:p=[],devModeChecks:d={}}=a,y=Q(c),f=Q(p),m=X(t),h=u((function(){return r++,o.apply(null,arguments)}),...y);const v=l((function(){i++;const t=Z(m,arguments);return e=h.apply(null,t),e}),...f);return Object.assign(v,{resultFunc:o,memoizedResultFunc:h,dependencies:m,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>e,recomputations:()=>r,resetRecomputations:()=>{r=0},memoize:u,argsMemoize:l})};return Object.assign(r,{withTypes:()=>r}),r}var rt=nt(et),it=Object.assign(((t,e=rt)=>{!function(t,e="expected an object, instead received "+typeof t){if("object"!=typeof t)throw new TypeError(e)}(t,"createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof t);const n=Object.keys(t);return e(n.map((e=>t[e])),((...t)=>t.reduce(((t,e,r)=>(t[n[r]]=e,t)),{})))}),{withTypes:()=>it});const st=rt([t=>t.getIn(["layout"])],(t=>t.getIn(["current"]))),ot=rt([t=>t.getIn(["userActivity"])],(t=>t.getIn(["last"]))),at=rt([t=>t.getIn(["layout"])],(t=>t.getIn(["items"]))),ut=(t,e,n={})=>t.getIn([e],n),ct=(t,e,n=5)=>ut(t,e,[]).slice(0-n),lt=t=>t.getIn(["savedState"]),pt=rt([t=>t.getIn(["userActivity"])],(t=>t.getIn(["status"]))),dt=rt([t=>t.getIn(["presetSession","items","length"]),t=>t.getIn(["presetSession","current"])],((t,e)=>{const n=e+1;if(!(n>0&&n<=t))return!1;return t>1&&!(n>=t)})),yt=rt([t=>t.getIn(["presetSession","items","length"]),t=>t.getIn(["presetSession","current"])],((t,e)=>{const n=e+1;if(!(n>0&&n<=t))return!1;return t>1&&0<e})),ft=rt([t=>t.getIn(["layout","items","length"]),t=>t.getIn(["layout","current"])],((t,e)=>{const n=e+1;if(!(n>0&&n<=t))return!1;return t>1&&!(n>=t)})),mt=rt([t=>t.getIn(["layout","items","length"]),t=>t.getIn(["layout","current"])],((t,e)=>{const n=e+1;if(!(n>0&&n<=t))return!1;return t>1&&0<e})),ht=t=>t.getIn(["layout","isHistoryTrackingEnabled"]),vt=t=>t.getIn(["presetSession","isPresetActive"]),gt=(0,u.debounce)((()=>{(0,o.dispatch)("divi/history").setUserActivityStatus({status:"idle"}),(0,o.dispatch)("divi/edit-post").clearRemovedModules({layout:(0,o.select)("divi/settings").getSetting(["themeBuilder","layout"]),caller:"user"})}),6e3),St=(t,e)=>{st(e.getState())+1===(0,u.size)(at(e.getState()))&&gt()},It=(t,e)=>{const n=e.getState(),r=n.getIn(["presetSession","current"]),i=n.getIn(["presetSession","items"])[r];i&&(0,o.dispatch)("divi/global-data").overridePresetData(i.presetItems)},bt=(t,e)=>{const n=(0,o.select)("divi/modal-library").getModal("divi/module"),r=n?.isActive??!1,i=n?.owner??"",s=e.getState(),a=s.getIn(["layout","items"]),c=s.getIn(["layout","current"]),l=s.getIn(["layout","lastEditedState"]);if(0===Object.keys(l)?.length){const t=(0,o.select)("divi/edit-post").getContent();(0,o.dispatch)("divi/history").setLastEditedLayoutState({layoutState:t})}const p=a?.[c]?.state,d=a?.[c]?.moduleId,y=(0,o.select)("divi/edit-post").getGlobalLayoutId(d),f=!!y;if(r&&!p?.[i]&&(0,o.dispatch)("divi/modal-library").close({name:"divi/module"}),(0,o.dispatch)("divi/edit-post").setLayoutState({location:"content",layoutState:p}),f){const t=(0,o.select)("divi/edit-post").getModuleAttrs(d),e=(0,u.omit)(t,["globalModule","localAttrsMap","modulePreset"]);(0,o.dispatch)("divi/history").disableHistoryTracking(),(0,u.forEach)(e,((t,e)=>{(0,o.dispatch)("divi/edit-post").editModuleAttribute({id:d,attrName:e,value:t,caller:"history",subName:!1})})),(0,o.dispatch)("divi/history").enableHistoryTracking(),(0,o.dispatch)("divi/global-layouts").saveLayoutWithoutHistoryEntry({id:y,owner:d})}},Et={ADD_ACTION_ITEM:[St],ADD_LAYOUT_ITEM:[St],JUMP_TO_LAYOUT_ITEM:[bt],PRESET_SESSION_REDO:[It],PRESET_SESSION_UNDO:[It],REDO:[bt],UNDO:[bt]},Tt=()=>({actions:{"divi/events":{items:[],limit:50}},"edit-post":[],layout:{current:-1,items:[],lastEditedState:w()({}),limit:50,isHistoryTrackingEnabled:!0},savedState:{content:(0,o.select)("divi/serialized-post").getState(["postContent","content"]),settings:(0,O.asMutable)((0,o.select)("divi/page-settings").getSettings(),{deep:!0})},userActivity:{status:"idle",last:{timestamp:0,storeName:"",actionType:""}},presetSession:{isPresetActive:!1,current:-1,items:[],limit:50}}),At={"*":[()=>t=>e=>{if(!(0,o.select)("divi/history").isHistoryTrackingEnabled()&&"ENABLE_HISTORY_TRACKING"!==e.type)return null;return t(e)}]},_t=(t,e)=>{switch(e.type){case"ADD":{const n=[].concat(t.getIn([e.category],[]));return n.push({actionType:e.actionType,trigger:e.trigger,payload:e.payload}),t.setIn([e.category],n)}case"ADD_ACTION_ITEM":return((t,e)=>{const{storeName:n}=e.params,r=t?.getIn(["actions",n,"limit"])??50,i=t.getIn(["actions",n,"items"]).asMutable({deep:!0});return i.push(e.params),i.length>r&&i?.shift(),t.setIn(["actions",n,"items"],i).setIn(["userActivity","status"],"edited").setIn(["userActivity","last"],{storeName:n,actionType:e?.params?.action?.type,timestamp:e?.params?.timestamp})})(t,e);case"ADD_LAYOUT_ITEM":return((t,e)=>{const n=t.getIn(["layout","items"]),r=t.getIn(["layout","limit"]),i=t.getIn(["layout","current"]),s=i+1,o=s<n.length,a=o?n.slice(0,i+1):n,c=o?i+1:s>=r?r-1:i+1,l=t.setIn(["layout","current"],c).setIn(["layout","items"],a.concat((0,u.omit)(e.params,"storeName"))).setIn(["userActivity","status"],"edited").setIn(["userActivity","last"],{storeName:e?.params?.storeName,actionType:e?.params?.type,timestamp:e?.params?.timestamp});if(l.getIn(["layout","items","length"])>r){const t=l.getIn(["layout","items"]).asMutable();return t?.shift(),l.setIn(["layout","items"],t)}return l})(t,e);case"ADD_PRESET_SESSION_ITEM":return((t,e)=>{const n=t.getIn(["presetSession","items"]),r=t.getIn(["presetSession","current"]),i=t.getIn(["presetSession","limit"])??50,s=r+1<n.length?n.slice(0,r+1):n,o=r+1,a=t.setIn(["presetSession","current"],o).setIn(["presetSession","items"],s.concat(e.params));if(a.getIn(["presetSession","items","length"])>i){const t=a.getIn(["presetSession","items"]);return a.setIn(["presetSession","items"],t.slice(1))}return a})(t,e);case"JUMP_TO_LAYOUT_ITEM":return((t,e)=>t.setIn(["layout","current"],e.params.layoutIndex))(t,e);case"RESET_STATE":return w()(Tt());case"SET_LAST_EDITED_LAYOUT_STATE":return((t,e)=>{const{layoutState:n}=e.params;return t.setIn(["layout","lastEditedState"],n)})(t,e);case"SET_SAVED_STATE":return((t,e)=>t.set("savedState",e.params))(t,e);case"REDO":return(t=>{if(!ft(t))return t;const e=t.getIn(["layout","items","length"])-1,n=t.getIn(["layout","current"]),r=Math.min(n+1,e);return t.setIn(["layout","current"],r)})(t);case"UNDO":return(t=>{if(!mt(t))return t;const e=t.getIn(["layout","current"]),n=Math.max(e-1,0);return t.setIn(["layout","current"],n)})(t);case"DISABLE_HISTORY_TRACKING":return t.setIn(["layout","isHistoryTrackingEnabled"],!1);case"ENABLE_HISTORY_TRACKING":return t.setIn(["layout","isHistoryTrackingEnabled"],!0);case"SET_USER_ACTIVITY_STATUS":return((t,e)=>t.setIn(["userActivity","status"],e.params.status))(t,e);case"START_PRESET_SESSION":return(t=>t.setIn(["presetSession"],{isPresetActive:!0,current:-1,items:[]}))(t);case"END_PRESET_SESSION":return(t=>t.setIn(["presetSession"],{isPresetActive:!1,current:-1,items:[]}))(t);case"PRESET_SESSION_UNDO":return(t=>{if(!yt(t))return t;const e=t.getIn(["presetSession","current"]),n=Math.max(e-1,0);return t.setIn(["presetSession","current"],n)})(t);case"PRESET_SESSION_REDO":return(t=>{if(!dt(t))return t;const e=t.getIn(["presetSession","items","length"])-1,n=t.getIn(["presetSession","current"]),r=Math.min(n+1,e);return t.setIn(["presetSession","current"],r)})(t);default:return t}},Ot=()=>{if((0,o.select)("divi/history"))return;(0,o.select)("divi/serialized-post")||(0,M.registerSerializedPostStore)(),(0,o.select)("divi/page-settings")||(0,D.registerPageSettingsStore)();const n=w()(Tt()),r=(0,o.registerStore)("divi/history",{actions:t,reducer:_t,selectors:e,initialState:n});(0,P.applyMiddlewares)(r,At),(0,P.applyEffects)(r,Et)}}(),(window.divi=window.divi||{}).history=r}();